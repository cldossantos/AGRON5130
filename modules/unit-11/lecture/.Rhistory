select(whc:ppd, gdd) %>%
scale()
cluster_ready_data = clean_data %>%
select(whc:ppt, gdd) %>%
scale()
cluster_ready_data = clean_data %>%
select(whc:ppt, gdd)
cluster_ready_data = clean_data %>%
select(whc:ppt, gdd)
cluster_ready_data = cluster_ready_data %>%
scale()
# cluster identification
clusters = kmeans(cluster_ready_data, i)
# cluster identification
clusters = kmeans(cluster_ready_data, 3)
cluster_ready_data = clean_data %>%
select(whc:ppt, gdd) %>%
na.omit()
cluster_ready_data = cluster_ready_data %>%
scale()
# cluster identification
clusters = kmeans(cluster_ready_data, 3)
cluster_ready_data = clean_data %>%
select(whc:ppt, gdd) %>%
na.omit()
cluster_ready_data = cluster_ready_data %>%
scale()
# cluster identification
clusters = kmeans(cluster_ready_data, 3)
clusters$centers
cluster_ready_data = clean_data %>%
select(whc:om, ppt, gdd) %>%
na.omit()
cluster_ready_data = cluster_ready_data %>%
scale()
# cluster identification
clusters = kmeans(cluster_ready_data, 3)
clusters$centers
# classify centers and rejoin with original data
centers = as.data.frame(clusters$centers) %>%
mutate(cluster = row_number()) %>%
gather(attribute, value, -cluster) %>%
mutate(named_value = case_when(value < -0.8 ~ "low",
value > 0.8 ~ "high",
value >= -0.8 & value <=0.8 ~ "ave")) %>%
dplyr::select(-value) %>%
spread(attribute, named_value) %>%
mutate(cluster = as.numeric(cluster)) %>%
rename(om_class = om,
ppt_class = ppt,
clay_class = clay,
silt_class = silt,
sand_class = sand)
# classify centers and rejoin with original data
centers = as.data.frame(clusters$centers) %>%
mutate(cluster = row_number()) %>%
gather(attribute, value, -cluster) %>%
mutate(named_value = case_when(value < -0.8 ~ "low",
value > 0.8 ~ "high",
value >= -0.8 & value <=0.8 ~ "ave")) %>%
dplyr::select(-value) %>%
spread(attribute, named_value) %>%
mutate(cluster = as.numeric(cluster)) %>%
rename(om_class = om,
ppt_class = ppt,
clay_class = clay,
silt_class = silt,
sand_class = sand,
whc_class = whc,
gdd_class = gdd)
cluster_df <- clusters$cluster %>%
enframe(name=NULL, value="cluster")
classified_data <-  selected_data %>%
cbind(cluster_df) %>%
left_join(centers, by="cluster") %>%
mutate(number_of_clusters = i)
classified_data <-  cluster_ready_data %>%
cbind(cluster_df) %>%
left_join(centers, by="cluster") %>%
mutate(number_of_clusters = i)
classified_data <-  cluster_ready_data %>%
cbind(cluster_df) %>%
left_join(centers, by="cluster")
View(classified_data)
classified_data_w_geo = classified_data %>%
left_join(counties) %>%
st_as_sf()
names(classified_data)
classified_data_w_geo = classified_data %>%
cbind(counties) %>%
st_as_sf()
classified_data_w_geo = clean_data_w_geo %>%
select(stco, geometry)
classified_data_w_geo = clean_data_w_geo %>%
select(stco, geometry) %>%
left_join(classified_data)
classified_data_w_geo = clean_data_w_geo %>%
select(stco, geometry) %>%
cbind(classified_data)
classified_data_w_geo = clean_data_w_geo %>%
select(stco, geometry) %>%
cbind(classified_data) %>%
st_as_sf()
classified_data_w_geo = st_transform(classified_data_w_geo, 4326)
pal_ppt = colorBin("RdYlGn", classified_data_w_geo$ppt)
classified_data_w_geo %>%
leaflet() %>%
addTiles() %>%
addPolygons(
fillColor = ~pal_ppt(ppt),
fillOpacity = 0.8,
weight=1,
color = "black"
) %>%
addLegend(pal = pal_ppt,
values = ~ppt
)
pal_ppt = colorNumeric("RdYlGn", classified_data_w_geo$cluster)
classified_data_w_geo %>%
leaflet() %>%
addTiles() %>%
addPolygons(
fillColor = ~pal_ppt(cluster),
fillOpacity = 0.8,
weight=1,
color = "black"
) %>%
addLegend(pal = pal_ppt,
values = ~cluster
)
pal_ppt = colorFactor("RdYlGn", classified_data_w_geo$cluster)
classified_data_w_geo %>%
leaflet() %>%
addTiles() %>%
addPolygons(
fillColor = ~pal_ppt(cluster),
fillOpacity = 0.8,
weight=1,
color = "black"
) %>%
addLegend(pal = pal_ppt,
values = ~cluster
)
classified_data_w_geo %>%
leaflet() %>%
addTiles() %>%
addPolygons(
fillColor = ~pal_ppt(cluster),
fillOpacity = 0.8,
weight=1,
color = "black",
popup = paste0(om_class,
ppt_class,
clay_class,
silt_class,
sand_class,
whc_class,
gdd_class = gdd)
) %>%
addLegend(pal = pal_ppt,
values = ~cluster
)
classified_data_w_geo %>%
leaflet() %>%
addTiles() %>%
addPolygons(
fillColor = ~pal_ppt(cluster),
fillOpacity = 0.8,
weight=1,
color = "black",
popup = paste0(om_class,
ppt_class,
clay_class,
silt_class,
sand_class,
whc_class,
gdd_class)
) %>%
addLegend(pal = pal_ppt,
values = ~cluster
)
classified_data_w_geo %>%
leaflet() %>%
addTiles() %>%
addPolygons(
fillColor = ~pal_ppt(cluster),
fillOpacity = 0.8,
weight=1,
color = "black",
popup = paste0(classified_data_w_geo$om_class,
classified_data_w_geo$ppt_class,
classified_data_w_geo$clay_class,
classified_data_w_geo$silt_class,
classified_data_w_geo$sand_class,
classified_data_w_geo$whc_class,
classified_data_w_geo$gdd_class)
) %>%
addLegend(pal = pal_ppt,
values = ~cluster
)
classified_data_w_geo %>%
leaflet() %>%
addTiles() %>%
addPolygons(
fillColor = ~pal_ppt(cluster),
fillOpacity = 0.8,
weight=1,
color = "black",
popup = paste0("om:", classified_data_w_geo$om_class, <"br">,
classified_data_w_geo %>%
leaflet() %>%
addTiles() %>%
addPolygons(
fillColor = ~pal_ppt(cluster),
fillOpacity = 0.8,
weight=1,
color = "black",
popup = paste0("om:", classified_data_w_geo$om_class, "<br>",
classified_data_w_geo$ppt_class,
classified_data_w_geo$clay_class,
classified_data_w_geo$silt_class,
classified_data_w_geo$sand_class,
classified_data_w_geo$whc_class,
classified_data_w_geo$gdd_class)
) %>%
addLegend(pal = pal_ppt,
values = ~cluster
)
classified_data_w_geo %>%
leaflet() %>%
addTiles() %>%
addPolygons(
fillColor = ~pal_ppt(cluster),
fillOpacity = 0.8,
weight=1,
color = "black",
popup = paste0("om: ", classified_data_w_geo$om_class, "<br>",
"ppt: ", classified_data_w_geo$ppt_class, "<br>",
"clay: ", classified_data_w_geo$clay_class, "<br>",
"silt: ", classified_data_w_geo$silt_class, "<br>",
"sand: ", classified_data_w_geo$sand_class, "<br>",
"whc: ", classified_data_w_geo$whc_class, "<br>",
"gdd: ", classified_data_w_geo$gdd_class)
) %>%
addLegend(pal = pal_ppt,
values = ~cluster
)
z calculator
# classify centers and rejoin with original data
centers = as.data.frame(clusters$centers) %>%
mutate(cluster = row_number()) %>%
gather(attribute, value, -cluster) %>%
mutate(named_value = case_when(value < -0.45 ~ "low",
value > 0.45 ~ "high",
value >= -0.45 & value <=0.45 ~ "ave")) %>%
dplyr::select(-value) %>%
spread(attribute, named_value) %>%
mutate(cluster = as.numeric(cluster)) %>%
rename(om_class = om,
ppt_class = ppt,
clay_class = clay,
silt_class = silt,
sand_class = sand,
whc_class = whc,
gdd_class = gdd)
cluster_df <- clusters$cluster %>%
enframe(name=NULL, value="cluster")
classified_data <-  cluster_ready_data %>%
cbind(cluster_df) %>%
left_join(centers, by="cluster")
classified_data_w_geo = clean_data_w_geo %>%
select(stco, geometry) %>%
cbind(classified_data) %>%
st_as_sf()
classified_data_w_geo = st_transform(classified_data_w_geo, 4326)
pal_ppt = colorFactor("RdYlGn", classified_data_w_geo$cluster)
classified_data_w_geo %>%
leaflet() %>%
addTiles() %>%
addPolygons(
fillColor = ~pal_ppt(cluster),
fillOpacity = 0.8,
weight=1,
color = "black",
popup = paste0("om: ", classified_data_w_geo$om_class, "<br>",
"ppt: ", classified_data_w_geo$ppt_class, "<br>",
"clay: ", classified_data_w_geo$clay_class, "<br>",
"silt: ", classified_data_w_geo$silt_class, "<br>",
"sand: ", classified_data_w_geo$sand_class, "<br>",
"whc: ", classified_data_w_geo$whc_class, "<br>",
"gdd: ", classified_data_w_geo$gdd_class)
) %>%
addLegend(pal = pal_ppt,
values = ~cluster
)
clean_data = county_data %>%
filter(grepl("MI|OH|IN|IL|WI|MN|IA|NE", State))
library(urbnmapr)
counties = urbnmapr::get_urbn_map("counties", sf=TRUE) %>%
rename(stco = county_fips) %>%
mutate(stco = as.numeric(stco))
clean_data_w_geo = clean_data %>%
left_join(counties) %>%
st_as_sf()
clean_data_w_geo = st_transform(clean_data_w_geo, 4326)
pal_ppt = colorBin("RdYlGn", clean_data_w_geo$ppt)
clean_data_w_geo %>%
leaflet() %>%
addTiles() %>%
addPolygons(
fillColor = ~pal_ppt(ppt),
fillOpacity = 0.8,
weight=1,
color = "black"
) %>%
addLegend(pal = pal_ppt,
values = ~ppt
)
cluster_ready_data = clean_data %>%
select(whc:om, ppt, gdd) %>%
na.omit()
cluster_ready_data = cluster_ready_data %>%
scale()
# cluster identification
clusters = kmeans(cluster_ready_data, 3)
clusters$centers
centers = as.data.frame(clusters$centers) %>%
mutate(cluster = row_number()) %>%
gather(attribute, value, -cluster) %>%
mutate(named_value = case_when(value < -0.45 ~ "low",
value > 0.45 ~ "high",
value >= -0.45 & value <=0.45 ~ "ave")) %>%
dplyr::select(-value) %>%
spread(attribute, named_value) %>%
mutate(cluster = as.numeric(cluster)) %>%
rename(om_class = om,
ppt_class = ppt,
clay_class = clay,
silt_class = silt,
sand_class = sand,
whc_class = whc,
gdd_class = gdd)
cluster_df <- clusters$cluster %>%
enframe(name=NULL, value="cluster")
classified_data <-  cluster_ready_data %>%
cbind(cluster_df) %>%
left_join(centers, by="cluster")
classified_data_w_geo = clean_data_w_geo %>%
select(stco, geometry) %>%
cbind(classified_data) %>%
st_as_sf()
classified_data_w_geo = st_transform(classified_data_w_geo, 4326)
pal_ppt = colorFactor("RdYlGn", classified_data_w_geo$cluster)
classified_data_w_geo %>%
leaflet() %>%
addTiles() %>%
addPolygons(
fillColor = ~pal_ppt(cluster),
fillOpacity = 0.8,
weight=1,
color = "black",
popup = paste0("om: ", classified_data_w_geo$om_class, "<br>",
"ppt: ", classified_data_w_geo$ppt_class, "<br>",
"clay: ", classified_data_w_geo$clay_class, "<br>",
"silt: ", classified_data_w_geo$silt_class, "<br>",
"sand: ", classified_data_w_geo$sand_class, "<br>",
"whc: ", classified_data_w_geo$whc_class, "<br>",
"gdd: ", classified_data_w_geo$gdd_class)
) %>%
addLegend(pal = pal_ppt,
values = ~cluster
classified_data_w_geo = clean_data_w_geo %>%
classified_data_w_geo = clean_data_w_geo %>%
select(stco, geometry) %>%
cbind(classified_data) %>%
st_as_sf()
classified_data_w_geo = st_transform(classified_data_w_geo, 4326)
pal_ppt = colorFactor("RdYlGn", classified_data_w_geo$cluster)
classified_data_w_geo %>%
leaflet() %>%
addTiles() %>%
addPolygons(
fillColor = ~pal_ppt(cluster),
fillOpacity = 0.8,
weight=1,
color = "black",
popup = paste0("om: ", classified_data_w_geo$om_class, "<br>",
"ppt: ", classified_data_w_geo$ppt_class, "<br>",
"clay: ", classified_data_w_geo$clay_class, "<br>",
"silt: ", classified_data_w_geo$silt_class, "<br>",
"sand: ", classified_data_w_geo$sand_class, "<br>",
"whc: ", classified_data_w_geo$whc_class, "<br>",
"gdd: ", classified_data_w_geo$gdd_class)
) %>%
addLegend(pal = pal_ppt,
values = ~cluster
)
library(readr)
library(tidyverse)
library(sf)
library(leaflet)
library(RColorBrewer)
county_data = read_csv("input/environments_by_county.csv")
library(readr)
library(tidyverse)
library(sf)
library(leaflet)
library(RColorBrewer)
county_data = read_csv("input/environments_by_county.csv")
library(readr)
library(tidyverse)
library(sf)
library(leaflet)
library(RColorBrewer)
county_data = read_csv("data/environments_by_county.csv")
clean_data = county_data %>%
filter(grepl("MI|OH|IN|IL|WI|MN|IA|ND|SD|NE", State))
library(urbnmapr)
counties = urbnmapr::get_urbn_map("counties", sf=TRUE) %>%
rename(stco = county_fips) %>%
mutate(stco = as.numeric(stco))
clean_data_w_geo = clean_data %>%
left_join(counties) %>%
st_as_sf()
clean_data_w_geo = st_transform(clean_data_w_geo, 4326)
pal_ppt = colorBin("RdYlGn", clean_data_w_geo$ppt)
clean_data_w_geo %>%
leaflet() %>%
addTiles() %>%
addPolygons(
fillColor = ~pal_ppt(ppt),
fillOpacity = 0.8,
weight=1,
color = "black"
) %>%
addLegend(pal = pal_ppt,
values = ~ppt
)
pal_ppt = colorBin("RdYlGn", clean_data_w_geo$sand)
pal_sand = colorBin("RdYlGn", clean_data_w_geo$sand)
clean_data_w_geo %>%
leaflet() %>%
addTiles() %>%
addPolygons(
fillColor = ~pal_sand(sand),
fillOpacity = 0.8,
weight=1,
color = "black"
) %>%
addLegend(pal = pal_sand,
values = ~sand
)
pal_sand = colorBin("RdYlGn", clean_data_w_geo$silt)
clean_data_w_geo %>%
leaflet() %>%
addTiles() %>%
addPolygons(
fillColor = ~pal_sand(silt),
fillOpacity = 0.8,
weight=1,
color = "black"
) %>%
addLegend(pal = pal_sand,
values = ~silt
)
pal_sand = colorBin("RdYlGn", clean_data_w_geo$sand)
clean_data_w_geo %>%
leaflet() %>%
addTiles() %>%
addPolygons(
fillColor = ~pal_sand(sand),
fillOpacity = 0.8,
weight=1,
color = "black"
) %>%
addLegend(pal = pal_sand,
values = ~sand
)
pal_sand = colorBin("RdYlGn", bins = 5, clean_data_w_geo$sand)
clean_data_w_geo %>%
leaflet() %>%
addTiles() %>%
addPolygons(
fillColor = ~pal_sand(sand),
fillOpacity = 0.8,
weight=1,
color = "black"
) %>%
addLegend(pal = pal_sand,
values = ~sand
)
pal_ppt = colorBin("RdYlGn", bins=5, clean_data_w_geo$ppt)
clean_data_w_geo %>%
leaflet() %>%
addTiles() %>%
addPolygons(
fillColor = ~pal_ppt(ppt),
fillOpacity = 0.8,
weight=1,
color = "black"
) %>%
addLegend(pal = pal_ppt,
values = ~ppt
)
range(clean_data_w_geo$gdd)
range(clean_data_w_geo$clay)
range(clean_data_w_geo$silt)
range(clean_data_w_geo$om)
View(counties)
View(county_data)
View(county_data$ppt)
range(clean_data_w_geo$ppt)
