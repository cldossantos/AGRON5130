knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)
library(tidyverse)
hybrid_data = read.csv("data/grateful_data.csv")
head(hybrid_data)
hybrid_data %>%
ggplot(aes(x=col, y=row, label=Hybrid)) +
geom_tile(fill="grey", color="black") +
geom_text(aes(label = Hybrid))
hybrid_data %>%
ggplot(aes(x=col, y=row, label=Hybrid)) +
geom_tile(fill="grey", color="black") +
geom_text(aes(label = Hybrid))
trt_means= hybrid_data %>%
group_by(Hybrid) %>%
summarise(Yield = mean(Yield))
data_for_model = trt_means %>%
filter(row_number() %in% c(1,3)) %>%
mutate(x = c(0.5, -0.5))
fit_1 = lm(x ~ Yield, data=data_for_model)
pred_x = predict(fit_1, trt_means)
trt_means_w_x = cbind(trt_means, pred_x) %>%
as.data.frame() %>%
mutate(Yield = Yield - mean(Yield))
trt_means_plot = trt_means_w_x %>%
ggplot(aes(x=pred_x, y=Yield, label=Hybrid)) +
geom_point(color = "blue", size=4) +
geom_text(hjust=0) +
lims(x=c(-0.65, 0.65))
trt_means_plot
effects_data %>%
ggplot(aes(x=rank, y=T+E)) +
geom_point()+
geom_text(aes(x=rank-0.1, y=T, label=Hybrid, hjust=1)) +
geom_text(aes(x=rank+0.1, y=T+E, label=round(E, 1)), hjust=0, size=4) +
lims(x=c(0.5, 4.5))
effects_data %>%
ggplot(aes(x=rank, y=T)) +
geom_point() +
geom_text(aes(x=rank-0.1, y=T, label=Hybrid, hjust=1)) +
geom_text(aes(x=rank+0.1, y=T, label=round(T, 1)), hjust=0) +
lims(x=c(0.5, 4.5))
hybrid_rank = hybrid_data %>%
group_by(Hybrid) %>%
summarise(Yield = mean(Yield)) %>%
ungroup() %>%
arrange(Yield) %>%
mutate(rank = row_number()) %>%
select(-Yield)
effects_data = hybrid_data %>%
select(-col, -row) %>%
mutate(mu = mean(Yield)) %>%
arrange(Hybrid) %>%
group_by(Hybrid) %>%
mutate(T = mean(Yield) - mu) %>%
ungroup() %>%
mutate(E = Yield - T - mu) %>%
left_join(hybrid_rank)
hybrids = unique(effects_data$Hybrid)
effects_data %>%
ggplot(aes(x=rank, y=Yield)) +
geom_point() +
geom_text(aes(x=rank-0.1, y=mu+T, label=Hybrid, hjust=1)) +
lims(x=c(0.5, 4.5))
effects_data %>%
ggplot(aes(x=rank, y=T)) +
geom_point() +
geom_text(aes(x=rank-0.1, y=T, label=Hybrid, hjust=1)) +
geom_text(aes(x=rank+0.1, y=T, label=round(T, 1)), hjust=0) +
lims(x=c(0.5, 4.5))
effects_data %>%
ggplot(aes(x=rank, y=T+E)) +
geom_point()+
geom_text(aes(x=rank-0.1, y=T, label=Hybrid, hjust=1)) +
geom_text(aes(x=rank+0.1, y=T+E, label=round(E, 1)), hjust=0, size=4) +
lims(x=c(0.5, 4.5))
effects_data %>%
select(Hybrid, mu, T, E, Yield) %>%
mutate(mu = round(mu, 1),
T = round(T, 1),
E = round(E, 1)) %>%
rename(`Yield (mu + T + E)` = Yield)
library(grid)
library(pBrackets)
p = effects_data %>%
ggplot(aes(x=rank, y=T+E)) +
geom_point(size = 2) +
lims(x=c(0, 6))
p +  geom_text(aes(x=1.5, y=-7), label="Does the spread of\nindividuals within a treatment\nexplain more of the variance?",
hjust=0, vjust=0.5, size=5) +
geom_text(aes(x=4.4, y=0), label="Or does the\ndifference between\ntreatment means\nexplain more\nof the variance?",
hjust=0, vjust=0.5, size=5)
grid.locator(unit="native")
#
grid.brackets(180, 300, 180, 375, h=0.05, lwd=2, col="red")
grid.brackets(473, 60, 473, 335, h=0.05, lwd=2, col="red")
library(broom)
hybrid_test = tidy(aov(Yield ~ Hybrid, hybrid_data))
hybrid_test
summary(hybrid_test)
library(broom)
hybrid_test = tidy(aov(Yield ~ Hybrid, hybrid_data))
hybrid_test
trt_ss = effects_data %>%
select(Hybrid, mu, T) %>%
mutate(`T-square` = T^2)
# %>%
#   mutate(mu = round(mu, 1),
#          T = round(T, 1))
trt_ss
sum(trt_ss$`T-square`)
err_ss = effects_data %>%
select(Hybrid, mu, E) %>%
mutate(`E-square` = E^2)
err_ss
sum(err_ss$`E-square`)
library(sjPlot)
library(shiny)
ui <- fluidPage(
sidebarLayout(
sidebarPanel(
sliderInput("treatmentNo", "Select number of treatments", min=2, max=10, step=1, value=4),
sliderInput("repNo", "Select number of replications", min=2, max=10, step=1, value=4),
sliderInput("pLevel", "Select desired level of significance (%)", min = 0.01, max= 0.2,
step = 0.01, value = 0.05)
),
mainPanel(
plotOutput("plot"),
textOutput("dfText")
)
)
)
server <- function(input, output, session) {
output$plot = renderPlot({
dist_f(p = input$pLevel, deg.f1 = input$treatmentNo, deg.f2 = input$repNo, xmax = 10)
})
output$dfText = renderText({
paste0("Treatment DF: ", input$treatmentNo-1,
"\nError DF: ", (input$treatmentNo * (input$repNo-1 )))
})
}
shinyApp(ui, server)
library(sjPlot)
dist_f(p = 0.01, deg.f1 = 3, deg.f2 = 12, xmax = 10)
library(shiny)
library(broom)
set.seed(1)
ui <- fluidPage(
sidebarLayout(
sidebarPanel(
sliderInput("trtmean1", "Select Treatment Mean", min = 150, max=250, step=1, value=c(184)),
sliderInput("trtmean2", "Select Treatment Mean", min = 150, max=250, step=1, value=c(185)),
sliderInput("trtmean3", "Select Treatment Mean", min = 150, max=250, step=1, value=c(189)),
sliderInput("pooledsd", "Select Pooled Standard Deviation", min = 0, max=30, step=1, value=15)
),
mainPanel(
plotOutput("plot"),
tableOutput("anovaTable")
)
)
)
server <- function(input, output, session) {
obsData = reactive({
set.seed(1)
rnorm2 <- function(n,mean,sd) { mean+sd*scale(rnorm(n)) }
trtmean1 = input$trtmean1
trtmean2 = input$trtmean2
trtmean3 = input$trtmean3
sd = input$pooledsd
trt_1_data = data.frame(trt=rep("trt1", 6))
trt_1_data$yield = rnorm2(6, mean=trtmean1, sd = sd)
trt_2_data = data.frame(trt=rep("trt2", 6))
trt_2_data$yield = rnorm2(6, mean=trtmean2, sd = sd)
trt_3_data = data.frame(trt=rep("trt3", 6))
trt_3_data$yield = rnorm2(6, mean=trtmean3, sd = sd)
obs_data = rbind(trt_1_data, trt_2_data, trt_3_data)
})
anovaData = reactive({
obs_data = obsData()
anova_data = tidy(aov(yield~trt, data=obs_data))
})
distCurve = reactive({
obs_data = obsData()
anova_data = anovaData()
root_mse = anova_data %>%
filter(term=="Residuals") %>%
mutate(root_mse=sqrt(meansq)) %>%
select(root_mse) %>%
as.numeric()
root_tse = anova_data %>%
filter(term=="trt") %>%
mutate(root_mse=sqrt(meansq)) %>%
select(root_mse) %>%
as.numeric()
within_stats = obs_data %>%
group_by(trt) %>%
summarise(mean=mean(yield)) %>%
mutate(sd = root_mse) %>%
ungroup()
between_stats = obs_data %>%
mutate(trt="trt_dist") %>%
group_by(trt) %>%
summarise(mean = mean(yield)) %>%
mutate(sd = root_tse) %>%
select(trt, mean, sd)
overall_stats = rbind(within_stats, between_stats) %>%
rename(group = trt)
library(purrr)
dist_curve = overall_stats %>%
group_by(group) %>%
mutate(min = mean - 3.5*sd) %>%
mutate(max = mean + 3.5*sd) %>%
mutate(yield = map2(min, max, seq, by=0.1)) %>%
unnest(yield) %>%
mutate(prob = scale(dnorm(yield, mean = mean, sd = sd))) %>%
ungroup()
})
output$plot = renderPlot({
obs_data = obsData()
dist_curve = distCurve()
within_data = dist_curve %>%
filter(!group=="trt_dist")
between_data = dist_curve %>%
filter(group=="trt_dist")
ggplot(within_data, aes(x=yield, y=prob)) +
geom_point(aes(color=group)) +
geom_point(data = between_data, aes(x=yield, y=prob), color="black") +
geom_point(data=obs_data, aes(x = yield, y=-0.001, color=trt), size=3) +
theme(axis.ticks.y = element_blank(),
axis.text.y = element_blank())
})
output$anovaTable = renderTable({
anova_data = anovaData()
})
}
shinyApp(ui, server, options = list(height="450px"))
